<link rel="import" href="../../bower/polymer/polymer.html">
<link rel="import" href="app-store.html">

<dom-module id="symbol-url">
    <template>
        <app-store id="store"></app-store>
    </template>
    <script>
        (function () {
            let series;

            class SymbolUrl {
                beforeRegister() {
                    this.is = 'symbol-url';
                    this.isReady = false;

                    this.properties = {
                        symbol: {
                            type: String,
                            notify: true,
                            observer: 'updateSymbol'
                        }
                    };
                }

                attached() {
                    let symbol = (location.search.match(/^\?q=(.*)$/) || [])[1];

                    if (symbol && symbol !== this.symbol) {
                        this.$.store.dispatch(this.$.store.actions.TICKER_SYMBOL_CHANGE, {symbol: symbol});
                    }
                    this.isReady = true;
                }

                updateSymbol() {
                    if (this.isReady) { // this function is called before `attached`
                        history.replaceState(null, this.symbol, this.symbol === 'random' ? '?' : `?q=${this.symbol}`);
                    }
                }
            }

            Polymer(SymbolUrl);
        })();
    </script>
</dom-module>
