<link rel="import" href="../../../bower/polymer/polymer.html">

<dom-module id="ticker-reducer">
    <script>
        (function () {
            'use strict';

            class GraphReducer {
                beforeRegister() {
                    this.is = 'graph-reducer';
                }

                get actions() {
                    return ['ADD_DATA_ITEM', 'FILTER_SYMBOL_CHANGE', 'FILTER_INTERVAL_CHANGE', 'FILTER_SAMPLES_CHANGE'];
                }

                transform(state, action, data) {
                    let filter;

                    switch (action) {
                        case 'ADD_DATA_ITEM':
                            // TODO ??? NOTE that data array is still the same
                            let items = Object.assign([], state.data || []);
                            items.push(data.item);

                            if (items.length === state.filter.samples) {
                                items.shift();
                            }

                            return Object.assign({}, state, {data: items});
                        case 'FILTER_SYMBOL_CHANGE':
                            filter = Object.assign({}, state.filter, {symbol: data.symbol});
                            return Object.assign({}, state, {filter}, {data: []});
                            //return Object.assign({}, state, {quote: data});
                        case 'FILTER_INTERVAL_CHANGE':
                            filter = Object.assign({}, state.filter, {interval: data.interval});
                            return Object.assign({}, state, {filter});
                        case 'FILTER_SAMPLES_CHANGE':
                            let length = state.data.length,
                                dataSamples = state.data;

                            if (length > data.samples) {
                                dataSamples = state.data.slice(length - data.samples);
                            }

                            filter = Object.assign({}, state.filter, {samples: Math.min(100, data.samples)});
                            return Object.assign({}, state, {filter}, {data: dataSamples});
                        default:
                            return state;
                    }
                }
            }

            Polymer(GraphReducer);
        })();
    </script>
</dom-module>
