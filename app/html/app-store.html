<link rel="import" href="../../bower/polymer/polymer.html">

<dom-module id="app-store">
    <script>
        (function () {
            let appStore;

            class AppStore {
                beforeRegister() {
                    this.is = 'app-store';

                    this.properties = {
                        state: {
                            notify:   true,
                            readOnly: true,
                            type:     Object,
                            value:    {filter: {interval: 1000, samples: 20}}
                        },
                        reducer: {
                            notify:   true,
                            observer: 'updateReducer',
                            readOnly: false,
                            type:     Object
                        }
                    };
                }

                updateReducer(reducer) {
                    if (reducer) {
                        appStore = this; // Only use one store
                    }
                }

                dispatch(action, data) {
                    let newState = appStore.reducer.transform(appStore.state, action, data);

                    if (newState === appStore.state) {
                        throw `Unknown action: ${action}`;
                    }

                    appStore._setState(newState);
                }

                get state() { return appStore.state;}
            }

            Polymer(AppStore);
        })();
    </script>
</dom-module>
