<link rel="import" href="../../../bower/polymer/polymer.html">
<link rel="import" href="../app-store.html">

<dom-module id="random-ticker">
    <template>
        <app-store id="store"></app-store>
    </template>

    <script>
        (function () {
            'use strict';

            class RandomTicker {
                beforeRegister() {
                    this.is = 'random-ticker';

                    this.properties = {
                        interval: {
                            notify: true,
                            observer: 'updateInterval',
                            type: Number
                        }
                    };
                }

                generator() {
                  let x = new Date(),
                      y = Math.floor(Math.random() * 100) + 1;

                   return [x, y];
                }

                updateInterval() {
                    this.changeInterval = true;
                }

                start() {
                  if (!this.timer) {
                      this.timer = setInterval(() => {
                          let price = this.generator;

                          this.$.store.dispatch(this.$.store.actions.QUOTE_CHANGE,
                              {
                                  quote: {
                                      Price: price,
                                      Change: (price - this.lastPrice > 0 ? '+' : '') + (price - this.lastPrice)
                                  }
                              });

                          if (this.changeInterval) {
                              this.changeInterval = false;
                              this.restart();
                          }
                      }, this.interval);
                  }
                }

                stop() {
                  clearTimeout(this.timer);
                  this.timer = null;

                  return this;
                }

                restart() {
                    this.stop().start();
                }
            }

            Polymer(RandomTicker);
        })();
    </script>
</dom-module>
